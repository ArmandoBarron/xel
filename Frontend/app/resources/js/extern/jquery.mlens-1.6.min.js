/*! jquery.mlens.js - magnifying lens jQuery plugin for images by Federica Sibella (@musings.it) - Double licensed MIT and GPLv3 */
!function(e){function r(e){if("string"==typeof e){var r=e.indexOf("_");-1!=r&&(e=e.substr(r+1))}return e}function i(e,r){if("string"==typeof e){var i=e.indexOf(r);if(-1!=i)return!0}return!1}var t=[],n=0,o={init:function(r){var o={lensShape:"square",lensSize:[100,100],borderSize:4,borderColor:"#888",borderRadius:0,imgSrc:"",imgSrc2x:"",lensCss:"",imgOverlay:"",overlayAdapt:!0,zoomLevel:1,responsive:!0},a=e.extend({},o,r),s="100px",d="100px";this.each(function(){var r=e(this),u=r.data("mlens"),g=e(),c=e(),l=e(),p=e(),S=r.attr("src"),h="auto";("number"!=typeof a.zoomLevel||a.zoomLevel<=0)&&(a.zoomLevel=o.zoomLevel);var b=new Image;""!==a.imgSrc2x&&window.devicePixelRatio>1?(S=a.imgSrc2x,b.onload=function(){h=String(parseInt(this.width/2)*a.zoomLevel)+"px",g.css({backgroundSize:h+" auto"}),p.css({width:h})},b.src=S):(""!==a.imgSrc&&(S=a.imgSrc),b.onload=function(){h=String(parseInt(this.width)*a.zoomLevel)+"px",g.css({backgroundSize:h+" auto"}),p.css({width:h})},b.src=S),jQuery.isArray(a.lensSize)===!0?(s=i(a.lensSize[0],"%")||i(a.lensSize[0],"px")?String(a.lensSize[0]):String(a.lensSize[0])+"px",d=i(a.lensSize[1],"%")||i(a.lensSize[1],"px")?String(a.lensSize[1]):String(a.lensSize[1])+"px"):(s=i(a.lensSize,"%")||i(a.lensSize,"px")?String(a.lensSize):String(a.lensSize)+"px",d=s);var m="background-position: 0px 0px;width: "+s+";height: "+d+";float: left;display: none;border: "+String(a.borderSize)+"px solid "+a.borderColor+";background-repeat: no-repeat;position: absolute;",v="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";switch(a.overlayAdapt===!0&&(v+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),a.lensShape){case"square":m=m+"border-radius:"+String(a.borderRadius)+"px;",v=v+"border-radius:"+String(a.borderRadius)+"px;";break;case"":m=m+"border-radius:"+String(a.borderRadius)+"px;",v=v+"border-radius:"+String(a.borderRadius)+"px;";break;case"circle":m+="border-radius: 50%;",v+="border-radius: 50%;";break;default:m=m+"border-radius:"+String(a.borderRadius)+"px;",v=v+"border-radius:"+String(a.borderRadius)+"px;"}return r.wrap("<div id='mlens_wrapper_"+n+"' />"),l=r.parent(),a.responsive===!0?r.css({width:"100%"}):l.css({width:r.width()}),g=e("<div id='mlens_target_"+n+"' style='"+m+"' class='"+a.lensCss+"'>&nbsp;</div>").appendTo(l),g.css({backgroundImage:"url('"+S+"')",backgroundSize:h+" auto",cursor:"none"}),p=e("<img style='display:none;width:"+h+";height:auto;max-width:none;max-height;none;' src='"+S+"' />").appendTo(l),""!==a.imgOverlay&&(c=e("<div id='mlens_overlay_"+n+"' style='"+v+"'>&nbsp;</div>"),c.css({backgroundImage:"url('"+a.imgOverlay+"')",cursor:"none"}),c.appendTo(g)),r.attr("data-id","mlens_"+n),g.mousemove(function(i){e.fn.mlens("move",r.attr("data-id"),i)}),r.mousemove(function(i){e.fn.mlens("move",r.attr("data-id"),i)}),g.on("touchmove",function(i){i.preventDefault();var t=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0];e.fn.mlens("move",r.attr("data-id"),t)}),r.on("touchmove",function(i){i.preventDefault();var t=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0];e.fn.mlens("move",r.attr("data-id"),t)}),g.hover(function(){e(this).show()},function(){e(this).hide()}),r.hover(function(){g.show()},function(){g.hide()}),g.on("touchstart",function(r){r.preventDefault(),e(this).show()}),g.on("touchend",function(r){r.preventDefault(),e(this).hide()}),r.on("touchstart",function(e){e.preventDefault(),g.show()}),r.on("touchend",function(e){e.preventDefault(),g.hide()}),r.data("mlens",{image:r,settings:a,target:g,imageTag:p,imgSrc:S,imgWidth:h,imageWrapper:l,overlay:c,instance:n,lensSizeHoriz:s,lensSizeVert:d}),u=r.data("mlens"),t[n]=u,n++,t})},move:function(e,i){e=r(e);var n=t[e],o=n.image,a=n.target,s=n.imageTag,d=o.offset(),u=parseInt(i.pageX-d.left),g=parseInt(i.pageY-d.top),c=s.width()/o.width(),l=s.height()/o.height();return u>0&&g>0&&u<o.width()&&g<o.height()&&(u=String(-((i.pageX-d.left)*c-a.width()/2)),g=String(-((i.pageY-d.top)*l-a.height()/2)),a.css({backgroundPosition:u+"px "+g+"px"}),u=String(i.pageX-d.left-a.width()/2),g=String(i.pageY-d.top-a.height()/2),a.css({left:u+"px",top:g+"px"})),n.target=a,t[e]=n,t},update:function(n){var o=r(e(this).attr("data-id")),a=t[o],s=a.image,d=a.target,u=a.overlay,g=a.imageTag,c=a.imgSrc,l=a.settings,p=e.extend({},l,n),S=a.lensSizeHoriz,h=a.lensSizeVert,b="auto",m=new Image;if(""!==p.imgSrc2x&&window.devicePixelRatio>1?(c=p.imgSrc2x,m.onload=function(){b=String(parseInt(this.width/2)*p.zoomLevel)+"px",d.css({backgroundSize:b+" auto"}),g.css({width:b})},m.src=c):(""!==p.imgSrc&&(c=p.imgSrc),m.onload=function(){b=String(parseInt(this.width)*p.zoomLevel)+"px",d.css({backgroundSize:b+" auto"}),g.css({width:b})},m.src=c),jQuery.isArray(p.lensSize)===!0)S=i(p.lensSize[0],"%")||i(p.lensSize[0],"px")?String(p.lensSize[0]):String(p.lensSize[0])+"px",h=i(p.lensSize[1],"%")||i(p.lensSize[1],"px")?String(p.lensSize[1]):String(p.lensSize[1])+"px";else if(i(p.lensSize,",")){var v=p.lensSize.split(",");S=i(v[0],"%")||i(v[0],"px")?String(v[0]):String(v[0])+"px",h=i(v[1],"%")||i(v[1],"px")?String(v[1]):String(v[1])+"px"}else S=i(p.lensSize,"%")||i(p.lensSize,"px")?String(p.lensSize):String(p.lensSize)+"px",h=S;var z="background-position: 0px 0px;width: "+S+";height: "+h+"; float: left;display: none;border: "+String(p.borderSize)+"px solid "+p.borderColor+";background-repeat: no-repeat;position: absolute;",f="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";switch(p.overlayAdapt===!0&&(f+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),p.lensShape){case"square":z=z+"border-radius:"+String(p.borderRadius)+"px;",f=f+"border-radius:"+String(p.borderRadius)+"px;";break;case"":z=z+"border-radius:"+String(p.borderRadius)+"px;",f=f+"border-radius:"+String(p.borderRadius)+"px;";break;case"circle":z+="border-radius: 50%;",f+="border-radius: 50%;";break;default:z=z+"border-radius:"+String(p.borderRadius)+"px;",f=f+"border-radius:"+String(p.borderRadius)+"px;"}return d.attr("style",z),g.attr("src",c),g.css({width:b}),d.css({backgroundImage:"url('"+c+"')",backgroundSize:b+" auto",cursor:"none"}),u.attr("style",f),u.css({backgroundImage:"url('"+p.imgOverlay+"')",cursor:"none"}),a.image=s,a.target=d,a.overlay=u,a.settings=p,a.imgSrc=c,a.imageTag=g,a.lensSizeHoriz=S,a.lensSizeVert=h,t[o]=a,t},destroy:function(){var i=r(e(this).attr("data-id")),n=t[i];n.target.remove(),n.imageTag.remove(),n.image.unwrap(),n.overlay.remove(),e.removeData(n,"mlens"),this.unbind(),this.element=null}};e.fn.mlens=function(r){return o[r]?o[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?void e.error("Method "+r+" does not exist on jQuery.mlens"):o.init.apply(this,arguments)}}(jQuery);