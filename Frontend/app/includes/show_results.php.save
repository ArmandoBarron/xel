<?php
include_once("../resources/conf.php");
include_once(TEMPLATES . "/pagination.php");
include_once(CLASES . "/class.Route.php");
include_once(CLASES . "/class.Images.php");
include_once("get_number_images.php");
include_once(PASSWORDS);

function results_polygons($res,$polis,$number_res,$per_page,$offset,$height,$adjacents,$page){

  $todownload = $_SESSION['descargas'];
  $total_pages = ceil($number_res/$per_page);
  $dir_imgs = "resources/".Route::getRoute("repo")[0]['route']."/".Route::getRoute("mins")[0]['route']."/";
  if(count($res)==0):?>
  <br>
    <div class='resultadosbusqueda'>
      <br>
      La busqueda no ha producido resultados.
    </div>
  <?php endif; ?>

  <div id="resultadosbusqueda" class="resultadosbusqueda"  style="height:<?php echo $height - 250; ?>px;" >
  <?php
  for ($i=$shape == "circulo" ? $offset : 0; $i < count($res) && $i<$offset+$per_page; $i++): ?>
    <?php if($shape == "circulo") echo $i+1; else echo $offset+$i+1;
    ?>)<br>
    <div  class='resultados'>
      <div class='miniatura'>
        <img id="<?php echo $res[$i]["nombre"] ?>" onclick='showImagesPolygon("<?php echo $res[$i]["date"] ?>","<?php echo $res[$i]["satelite"] ?>")' height='60' width='60' src='<?php echo $dir_imgs. $res[$i]["nombre"] ?>quickview.jpg'/>
      </div>
      <div class='info'>
        <b>Fecha:</b> <?php echo $res[$i]["date"] ?><br>
        <b>Catalogo</b>: <?php echo $res[$i]["satelite"] ?><br>
        <b>Cantidad de imágenes</b>: <?php echo $res[$i]["numero"] ?>
      </div>
      <div class='botones'>
        <?php if(in_array($res[$i]["nombre"],$polis)):  ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonImagesToMap("<?php echo $res[$i]["date"] ?>","poligono")' class='btn btn-secondary btn-xs'><span class='glyphicon glyphicon-eye-close' aria-hidden='true'></span> Ocultar polígono</button>
        <?php else: ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonImagesToMap("<?php echo $res[$i]["date"] ?>","poligono")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-eye-open' aria-hidden='true'></span> Ver polígono</button>
        <?php endif; ?>
        <?php if(in_array($res[$i]["nombre"],$overlaps)):  ?>
          <button type='button' id="btnShowImg<?php echo $res[$i]["nombre"] ?>"   onclick='polygonImagesToMap("<?php echo $res[$i]["date"] ?>","image")' class='btn btn-secondary btn-xs'><span class='glyphicon glyphicon-eye-close' aria-hidden='true'></span></button>
        <?php else: ?>
          <button type='button' id="btnShowImg<?php echo $res[$i]["nombre"] ?>"   onclick='polygonImagesToMap("<?php echo $res[$i]["date"] ?>","image")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-picture' aria-hidden='true'></span></button>
        <?php endif; ?>
        <span id="btn<?php echo $res[$i]["date"].$res[$i]["satelite"] ?>">
          <?php if(array_key_exists($res[$i]["date"].$res[$i]["satelite"],$todownload)):  ?>
            <button type='button' onclick='checkSession("addToCarPolygon","<?php echo $res[$i]["date"] ?>","remove","<?php echo $res[$i]["satelite"] ?>")' class='btn btn-danger btn-xs'> Eliminar </button>
          <?php else: ?>
            <button type='button'  onclick='checkSession("addToCarPolygon","<?php echo $res[$i]["date"] ?>","add","<?php echo $res[$i]["satelite"] ?>")' class='btn btn-default btn-xs'><span class='glyphicon glyphicon-plus' aria-hidden='true'></span> Agregar imágenes</button>
          <?php endif; ?>
        </span>


      </div>
    </div>
    <hr class='linea'>
  <?php endfor;  ?>
  </div>

  <?php
  paginate($page, $total_pages, $adjacents,"getResults");
}

function results_overlaps($res,$polis,$number_res,$per_page,$offset,$height,$adjacents,$page){
  $todownload = $_SESSION['descargas'];
  $total_pages = ceil($number_res/$per_page);
  $dir_imgs = "resources/".Route::getRoute("repo")[0]['route']."/".Route::getRoute("mins")[0]['route']."/";
  if(count($res)==0):?>
  <br>
    <div class='resultadosbusqueda'>
      <br>
      La busqueda no ha producido resultados.
    </div>
  <?php endif; ?>

  <div id="resultadosbusqueda" class="resultadosbusqueda"  style="height:<?php echo $height - 250; ?>px;" >
  <?php
  for ($i=$shape == "circulo" ? $offset : 0; $i < count($res) && $i<$offset+$per_page; $i++): ?>
    <?php if($shape == "circulo") echo $i+1; else echo $offset+$i+1;
    if(!$res[$i]["numero"]){
      #print_r($_POST);
      $res[$i]["numero"] = getNumberImagesOverlaps($res[$i]["path"],$res[$i]["row"],$_POST['satelites'])[0][0];
      #echo "xx".$res[$i]["numero"];
    }
    ?>
    )<br>
    <div  class='resultados'>
      <div class='miniatura'>
        <img id="<?php echo $res[$i]["nombre"] ?>" onclick='showImagesGroup("<?php echo $res[$i]["path"] ?>","<?php echo $res[$i]["row"] ?>","<?php echo $res[$i]["satelite"] ?>")' height='60' width='60' src='<?php echo $dir_imgs. $res[$i]["nombre"] ?>quickview.jpg'/>
      </div>
      <div class='info'>
        <b>Path</b>: <?php echo $res[$i]["path"] ?> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Row</b>:<?php echo $res[$i]["row"] ?><br>
        <b>Fecha más reciente:</b> <?php echo $res[$i]["newest"] ?><br>
        <b>Fecha más antigua:</b> <?php echo $res[$i]["oldest"] ?><br>
        <b>Catalogo</b>: <?php echo $res[$i]["satelite"] ?><br>
        <b>Cantidad de imágenes</b>: <?php echo $res[$i]["numero"] ?>
      </div>
      <div class='botones'>
        <?php if(in_array($res[$i]["nombre"],$polis)):  ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-secondary btn-xs'><span class='glyphicon glyphicon-eye-close' aria-hidden='true'></span> Ocultar polígono</button>
        <?php else: ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-eye-open' aria-hidden='true'></span> Ver polígono</button>
        <?php endif; ?>

        <span id="btn<?php  echo $res[$i]["path"]."_".$res[$i]["row"]."_".$res[$i]["satelite"]; ?>">
          <?php if(array_key_exists($res[$i]["path"]."_".$res[$i]["row"]."_".$res[$i]["satelite"],$todownload)):  ?>
            <button type='button' onclick='checkSession("addToCarOverleap","<?php echo $res[$i]["nombre"] ?>","<?php echo $res[$i]["path"] ?>","<?php echo $res[$i]["row"] ?>","<?php echo $res[$i]["satelite"] ?>","remove")' class='btn btn-danger btn-xs'> Eliminar </button>
          <?php else: ?>
            <button type='button'  onclick='checkSession("addToCarOverleap","<?php echo $res[$i]["nombre"] ?>","<?php echo $res[$i]["path"] ?>","<?php echo $res[$i]["row"] ?>","<?php echo $res[$i]["satelite"] ?>","add")' class='btn btn-default btn-xs'><span class='glyphicon glyphicon-plus' aria-hidden='true'></span> Agregar imágenes </button>
          <?php endif; ?>
        </span>
      </div>
    </div>
    <hr class='linea'>
  <?php endfor;  ?>
  </div>

  <?php
  paginate($page, $total_pages, $adjacents,"getResults");
}

function results_imgs($res,$polis,$overlaps,$number_res,$per_page,$offset,$height,$adjacents,$page,$idbusqueda,$shape){
  $image = new Images();
  $todownload = $_SESSION['descargas'];
  $total_pages = ceil($number_res/$per_page);
  $i = 0;
  $dir_imgs = "resources/".Route::getRoute("repo")[0]['route']."/".Route::getRoute("mins")[0]['route']."/";

  if(count($res)==0):?>
  <br>
    <div class='resultadosbusqueda'>
      <br>
      La busqueda no ha producido resultados.
    </div>
  <?php endif; ?>

  <div id="resultadosbusqueda" class="resultadosbusqueda"  style="height:<?php echo $height - 250; ?>px;" >
  <?php
  for ($i=$shape == "circulo" ? $offset : 0; $i < count($res) && $i<$offset+$per_page; $i++):?>
    <?php if($shape == "circulo") echo $i+1; else echo $offset+$i+1;
    ?>)<br>
    <div  class='resultados item'>
      <div class='miniatura'>
        <div class="imagen_res">
          <center>
            <img id="<?php echo $res[$i]["nombre"] ?>" onclick='showImage("<?php echo $res[$i]["nombre"] ?>")' height='60' width='60' src='<?php echo $dir_imgs. $res[$i]["nombre"] ?>quickview.jpg'/>
          </center>
        </div>
        <div class="likes">
          <?php for ($j=1; $j <= 5; $j++):
            if($j <= intval($res[$i]["rating"])): ?>
              <button id="btnStar<?php echo $res[$i]["id"].$j ?>" onclick='checkSession("rate",this,"<?php echo $res[$i]['id'] ?>",<?php echo $j ?>)' type="button" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
              </button>
            <?php else: ?>
              <button id="btnStar<?php echo $res[$i]["id"].$j ?>" onclick='checkSession("rate",this,"<?php echo $res[$i]['id'] ?>",<?php echo $j ?>)' type="button" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>
              </button>
          <?php endif;
            endfor; ?>
        </div>
      </div>
      <div class='info'>
        <b>ID: </b><a href="element.php?elemento=<?php echo $res[$i]['hash_name']?>&busqueda=<?php echo $idbusqueda; ?>"><?php echo $res[$i]['nombre']; ?></a><br>
        <b>Path</b>: <?php echo $res[$i]["path"] ?> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Row</b>:<?php echo $res[$i]["row"] ?><br>
        <b>Fecha:</b> <?php echo $res[$i]["date"] ?><br>
        <b>Catalogo</b>: <?php echo $res[$i]["satelite"] ?>
      </div>
      <div class='botones'>
        <button type='button' id="btnShowProducts<?php echo $res[$i]["nombre"] ?>"   onclick='verProducts("<?php echo $res[$i]["id"] ?>","<?php echo $res[$i]["nombre"] ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-globe' aria-hidden='true'></span> Derivados</button>
        <?php if(in_array($res[$i]["nombre"],$polis)):  ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-secondary btn-xs'><span class='glyphicon glyphicon-eye-close' aria-hidden='true'></span> Ocultar</button>
        <?php else: ?>
          <button type='button' id="btnShowPoly<?php echo $res[$i]["nombre"] ?>"   onclick='polygonToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-eye-open' aria-hidden='true'></span> Polígono</button>
        <?php endif; ?>
        <?php if(in_array($res[$i]["nombre"],$overlaps)):  ?>
          <button type='button'  title="Ocultar imágen del mapa"   id="btnShowImg<?php echo $res[$i]["nombre"] ?>"   onclick='imageToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-secondary btn-xs'><span class='glyphicon glyphicon-eye-close' aria-hidden='true'></span></button>
        <?php else: ?>
          <button type='button' title="Ver imágen en el mapa"  id="btnShowImg<?php echo $res[$i]["nombre"] ?>"   onclick='imageToMap("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-picture' aria-hidden='true'></span></button>
        <?php endif; ?>
        <button type='button' title="Ver metadatos" onclick='verMeta("<?php echo $res[$i]["nombre"] ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-file' aria-hidden='true'></span></button>
        <span id="btn<?php echo $res[$i]["nombre"] ?>">
          <?php if(array_key_exists($res[$i]["nombre"],$todownload)):  ?>
            <button title="Eliminar de las descargas" type='button'  onclick='checkSession("addToCar","<?php echo $res[$i]["nombre"] ?>","remove")' class='btn btn-danger btn-xs'> Eliminar</button>
          <?php else: ?>
            <button title="Agregar a descargas" type='button'  onclick='checkSession("addToCar","<?php echo $res[$i]["nombre"] ?>","add")' class='btn btn-default btn-xs'><span class='glyphicon glyphicon-plus' aria-hidden='true'></span></button>
          <?php endif; ?>
       </span>
       <button type='button' title="Copiar URL al portapapeles" onclick='copyTextToClipboard("<?php echo $_SERVER[HTTP_HOST]."/AEM-Eris/element.php?elemento=".$res[$i]["hash_nameq"]."&busqueda=".$idbusqueda ?>")' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-copy' aria-hidden='true'></span></button>
      </div>
    </div>

  <?php endfor;  ?>
  </div>
  <?php
  if($page > 0){
    paginate($page, $total_pages, $adjacents,"getResults");
  }
}

?>
