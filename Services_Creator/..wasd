version: '3'
services:
  bb_imputation: 
    image: sm_bb_imputation
    build: 
      context: ./BuildingBlocks/Imputation
      dockerfile: ./Dockerfile
    restart: always
    networks: 
      - service_mesh
    depends_on: 
      - coordinator
    environment: 
      TPS_MANAGER: http://tps_manager:5000
      API_GATEWAY: coordinator:5555
      NETWORK: wasd
      SERVICE_NAME: imputation
      SERVICE_IP: bb_imputation
      SERVICE_PORT: 80

  bb_data_clean: 
    image: sm_data_clean
    build: 
      context: ./BuildingBlocks/DataClean
      dockerfile: ./Dockerfile
    restart: always
    networks: 
      - service_mesh
    depends_on: 
      - coordinator
    environment: 
      TPS_MANAGER: http://tps_manager:5000
      API_GATEWAY: coordinator:5555
      NETWORK: wasd
      SERVICE_NAME: cleanning
      SERVICE_IP: bb_data_clean
      SERVICE_PORT: 80

  bb_clustering: 
    image: sm_bb_clustering
    build: 
      context: ./BuildingBlocks/ClusteringAlgh
      dockerfile: ./Dockerfile
    restart: always
    networks: 
      - service_mesh
    depends_on: 
      - coordinator
    environment: 
      TPS_MANAGER: http://tps_manager:5000
      API_GATEWAY: coordinator:5555
      NETWORK: wasd
      SERVICE_NAME: clustering_service
      SERVICE_IP: bb_clustering
      SERVICE_PORT: 80

  bb_acquisition_1: 
    image: sm_bb_acquisition
    build: 
      context: ./BuildingBlocks/Acq
      dockerfile: ./Dockerfile
    restart: always
    volumes: 
      - ./localdata/:/home/app/REQUEST/input_data
    networks: 
      - service_mesh
    depends_on: 
      - coordinator
    environment: 
      TPS_MANAGER: http://tps_manager:5000
      API_GATEWAY: coordinator:5555
      NETWORK: wasd
      SERVICE_NAME: Acquisition
      SERVICE_IP: bb_acquisition_1
      SERVICE_PORT: 80
    deploy: 
      placement: 
        constraints: 
          - node.role == manager

